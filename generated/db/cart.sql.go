// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: cart.sql

package db

import (
	"context"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

const addToCart = `-- name: AddToCart :one
INSERT INTO cart (group_id, user_id, item_id, quantity)
VALUES ($1, $2, $3, $4)
ON CONFLICT (group_id, user_id, item_id)
DO UPDATE SET quantity = cart.quantity + EXCLUDED.quantity
RETURNING group_id, user_id, item_id, quantity, created_at
`

type AddToCartParams struct {
	GroupID  uuid.UUID `json:"group_id"`
	UserID   uuid.UUID `json:"user_id"`
	ItemID   uuid.UUID `json:"item_id"`
	Quantity int32     `json:"quantity"`
}

type AddToCartRow struct {
	GroupID   uuid.UUID        `json:"group_id"`
	UserID    uuid.UUID        `json:"user_id"`
	ItemID    uuid.UUID        `json:"item_id"`
	Quantity  int32            `json:"quantity"`
	CreatedAt pgtype.Timestamp `json:"created_at"`
}

func (q *Queries) AddToCart(ctx context.Context, arg AddToCartParams) (AddToCartRow, error) {
	row := q.db.QueryRow(ctx, addToCart,
		arg.GroupID,
		arg.UserID,
		arg.ItemID,
		arg.Quantity,
	)
	var i AddToCartRow
	err := row.Scan(
		&i.GroupID,
		&i.UserID,
		&i.ItemID,
		&i.Quantity,
		&i.CreatedAt,
	)
	return i, err
}

const clearCart = `-- name: ClearCart :exec
DELETE FROM cart
WHERE group_id = $1 AND user_id = $2
`

type ClearCartParams struct {
	GroupID uuid.UUID `json:"group_id"`
	UserID  uuid.UUID `json:"user_id"`
}

func (q *Queries) ClearCart(ctx context.Context, arg ClearCartParams) error {
	_, err := q.db.Exec(ctx, clearCart, arg.GroupID, arg.UserID)
	return err
}

const getCartByUser = `-- name: GetCartByUser :many
SELECT c.group_id, c.user_id, c.item_id, c.quantity, c.created_at,
       i.name, i.description, i.type, i.stock, i.urls
FROM cart c
JOIN items i ON c.item_id = i.id
WHERE c.group_id = $1 AND c.user_id = $2
ORDER BY c.created_at DESC
`

type GetCartByUserParams struct {
	GroupID uuid.UUID `json:"group_id"`
	UserID  uuid.UUID `json:"user_id"`
}

type GetCartByUserRow struct {
	GroupID     uuid.UUID        `json:"group_id"`
	UserID      uuid.UUID        `json:"user_id"`
	ItemID      uuid.UUID        `json:"item_id"`
	Quantity    int32            `json:"quantity"`
	CreatedAt   pgtype.Timestamp `json:"created_at"`
	Name        string           `json:"name"`
	Description pgtype.Text      `json:"description"`
	Type        ItemType         `json:"type"`
	Stock       int32            `json:"stock"`
	Urls        []string         `json:"urls"`
}

func (q *Queries) GetCartByUser(ctx context.Context, arg GetCartByUserParams) ([]GetCartByUserRow, error) {
	rows, err := q.db.Query(ctx, getCartByUser, arg.GroupID, arg.UserID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []GetCartByUserRow{}
	for rows.Next() {
		var i GetCartByUserRow
		if err := rows.Scan(
			&i.GroupID,
			&i.UserID,
			&i.ItemID,
			&i.Quantity,
			&i.CreatedAt,
			&i.Name,
			&i.Description,
			&i.Type,
			&i.Stock,
			&i.Urls,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getCartItemCount = `-- name: GetCartItemCount :one
SELECT COUNT(*) as item_count, COALESCE(SUM(quantity), 0) as total_quantity
FROM cart
WHERE group_id = $1 AND user_id = $2
`

type GetCartItemCountParams struct {
	GroupID uuid.UUID `json:"group_id"`
	UserID  uuid.UUID `json:"user_id"`
}

type GetCartItemCountRow struct {
	ItemCount     int64       `json:"item_count"`
	TotalQuantity pgtype.Int8 `json:"total_quantity"`
}

func (q *Queries) GetCartItemCount(ctx context.Context, arg GetCartItemCountParams) (GetCartItemCountRow, error) {
	row := q.db.QueryRow(ctx, getCartItemCount, arg.GroupID, arg.UserID)
	var i GetCartItemCountRow
	err := row.Scan(&i.ItemCount, &i.TotalQuantity)
	return i, err
}

const removeFromCart = `-- name: RemoveFromCart :exec
DELETE FROM cart
WHERE group_id = $1 AND user_id = $2 AND item_id = $3
`

type RemoveFromCartParams struct {
	GroupID uuid.UUID `json:"group_id"`
	UserID  uuid.UUID `json:"user_id"`
	ItemID  uuid.UUID `json:"item_id"`
}

func (q *Queries) RemoveFromCart(ctx context.Context, arg RemoveFromCartParams) error {
	_, err := q.db.Exec(ctx, removeFromCart, arg.GroupID, arg.UserID, arg.ItemID)
	return err
}

const updateCartItemQuantity = `-- name: UpdateCartItemQuantity :one
UPDATE cart
SET quantity = $4
WHERE group_id = $1 AND user_id = $2 AND item_id = $3
RETURNING group_id, user_id, item_id, quantity, created_at
`

type UpdateCartItemQuantityParams struct {
	GroupID  uuid.UUID `json:"group_id"`
	UserID   uuid.UUID `json:"user_id"`
	ItemID   uuid.UUID `json:"item_id"`
	Quantity int32     `json:"quantity"`
}

type UpdateCartItemQuantityRow struct {
	GroupID   uuid.UUID        `json:"group_id"`
	UserID    uuid.UUID        `json:"user_id"`
	ItemID    uuid.UUID        `json:"item_id"`
	Quantity  int32            `json:"quantity"`
	CreatedAt pgtype.Timestamp `json:"created_at"`
}

func (q *Queries) UpdateCartItemQuantity(ctx context.Context, arg UpdateCartItemQuantityParams) (UpdateCartItemQuantityRow, error) {
	row := q.db.QueryRow(ctx, updateCartItemQuantity,
		arg.GroupID,
		arg.UserID,
		arg.ItemID,
		arg.Quantity,
	)
	var i UpdateCartItemQuantityRow
	err := row.Scan(
		&i.GroupID,
		&i.UserID,
		&i.ItemID,
		&i.Quantity,
		&i.CreatedAt,
	)
	return i, err
}
